# é¡¹ç›®ç»“æ„è¯´æ˜

## âœ… é‡æ„å®Œæˆ

é¡¹ç›®å·²æˆåŠŸé‡æ„ä¸º**æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åˆ†ç¦»**çš„ç›®å½•ç»“æ„ï¼Œå¹¶å¼•å…¥äº† `base` é€šç”¨åŸºç¡€åº“ã€‚

## ğŸ“‚ æ–°çš„ç›®å½•ç»“æ„

```
chatroom/
â”œâ”€â”€ CMakeLists.txt              # é¡¶å±‚CMakeé…ç½®ï¼ˆå­ç›®å½•ç®¡ç†ï¼‰
â”œâ”€â”€ README.md                   # å®Œæ•´é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ QUICKSTART.md               # å¿«é€Ÿå¼€å§‹æŒ‡å—
â”œâ”€â”€ STRUCTURE.md                # æœ¬æ–‡ä»¶ï¼šé¡¹ç›®ç»“æ„è¯´æ˜
â”œâ”€â”€ .gitignore                  # Gitå¿½ç•¥é…ç½®
â”œâ”€â”€ start_server.sh             # æœåŠ¡å™¨å¯åŠ¨è„šæœ¬
â”œâ”€â”€ start_client.sh             # å®¢æˆ·ç«¯å¯åŠ¨è„šæœ¬
â”‚
â”œâ”€â”€ base/                       # ğŸ§± åŸºç¡€åº“æ¨¡å—ï¼ˆå…±äº«ï¼‰
â”‚   â”œâ”€â”€ CMakeLists.txt          # åŸºç¡€åº“CMakeé…ç½®
â”‚   â”œâ”€â”€ include/                # åŸºç¡€åº“å¤´æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ database.h          # æ•°æ®åº“æ¥å£
â”‚   â”‚   â”œâ”€â”€ database_config.h   # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”œâ”€â”€ database_manager.h  # æ•°æ®åº“ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ mysql_database.h    # MySQLå®ç°
â”‚   â”‚   â”œâ”€â”€ sqlite_database.h   # SQLiteå®ç°
â”‚   â”‚   â”œâ”€â”€ chat_message.h      # æ¶ˆæ¯ç»“æ„å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ logger.h            # æ—¥å¿—æ¥å£
â”‚   â”‚   â””â”€â”€ stream_logger.h     # æµå¼æ—¥å¿—
â”‚   â””â”€â”€ src/                    # åŸºç¡€åº“æºæ–‡ä»¶
â”‚
â”œâ”€â”€ server/                     # ğŸ“¦ æœåŠ¡å™¨æ¨¡å—ï¼ˆç‹¬ç«‹ï¼‰
â”‚   â”œâ”€â”€ CMakeLists.txt          # æœåŠ¡å™¨ä¸“å±CMakeé…ç½®
â”‚   â”œâ”€â”€ include/                # æœåŠ¡å™¨å¤´æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ http_server.h       # HTTPæœåŠ¡å™¨å®ç°
â”‚   â”‚   â”œâ”€â”€ chatroom_server.h   # èŠå¤©å®¤æœåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ server_config.h     # æœåŠ¡å™¨é…ç½®
â”‚   â”œâ”€â”€ src/                    # æœåŠ¡å™¨æºæ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ http_server.cpp
â”‚   â”‚   â”œâ”€â”€ chatroom_server.cpp
â”‚   â”‚   â””â”€â”€ server_main.cpp     # æœåŠ¡å™¨å…¥å£
â”‚   â””â”€â”€ tests/                  # æœåŠ¡å™¨æµ‹è¯•
â”‚       â””â”€â”€ chatroom_test.cpp
â”‚
â”œâ”€â”€ client/                     # ğŸ“± å®¢æˆ·ç«¯æ¨¡å—ï¼ˆç‹¬ç«‹ï¼‰
â”‚   â”œâ”€â”€ CMakeLists.txt          # å®¢æˆ·ç«¯ä¸“å±CMakeé…ç½®
â”‚   â”œâ”€â”€ include/                # å®¢æˆ·ç«¯å¤´æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ chatroom_client.h
â”‚   â””â”€â”€ src/                    # å®¢æˆ·ç«¯æºæ–‡ä»¶
â”‚       â”œâ”€â”€ chatroom_client.cpp
â”‚       â””â”€â”€ client_main.cpp     # å®¢æˆ·ç«¯å…¥å£
â”‚
â””â”€â”€ build/                      # ç¼–è¯‘è¾“å‡ºç›®å½•
    â”œâ”€â”€ base/
    â”‚   â””â”€â”€ libchatroom_base.a  # âœ… åŸºç¡€é™æ€åº“
    â”œâ”€â”€ server/
    â”‚   â”œâ”€â”€ chatroom_server     # âœ… æœåŠ¡å™¨å¯æ‰§è¡Œæ–‡ä»¶
    â”‚   â””â”€â”€ chatroom_test       # âœ… æµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶
    â””â”€â”€ client/
        â””â”€â”€ chatroom_client     # âœ… å®¢æˆ·ç«¯å¯æ‰§è¡Œæ–‡ä»¶
```

## ğŸ¯ é‡æ„ä¼˜åŠ¿

### 1. **æ¨¡å—åŒ–æ¸…æ™°**
- **Base**: å­˜æ”¾é€šç”¨çš„æ•°æ®åº“ã€æ—¥å¿—ã€é…ç½®ç­‰ç»„ä»¶ï¼Œä¾› Server å’Œ Client å…±äº«ã€‚
- **Server**: ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å’Œç½‘ç»œå¤„ç†ã€‚
- **Client**: ä¸“æ³¨äºç”¨æˆ·äº¤äº’å’Œç½‘ç»œé€šä¿¡ã€‚

### 2. **æ•°æ®åº“å±‚æ¶æ„**
- **æŠ½è±¡æ¥å£**: `Database` çº¯è™šåŸºç±»å®šä¹‰äº†ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£ã€‚
- **å¤šåç«¯æ”¯æŒ**:
  - `SqliteDatabase`: é€‚ç”¨äºå•æœºã€è½»é‡çº§éƒ¨ç½²ï¼ˆé»˜è®¤ï¼‰ã€‚
  - `MysqlDatabase`: é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œæ”¯æŒé«˜å¹¶å‘ã€‚
- **è¿æ¥æ± åŒ–**: MySQL å®ç°æ”¯æŒè¿æ¥æ± ï¼ˆConnection Poolingï¼‰ï¼Œé€šè¿‡ `initial_size` å’Œ `max_size` é…ç½®å¹¶å‘è¿æ¥æ•°ï¼Œæ˜¾è‘—æå‡å¹¶å‘æ€§èƒ½ã€‚
- **çº¿ç¨‹å®‰å…¨**: `DatabaseManager` å•ä¾‹ç®¡ç†æ•°æ®åº“å®ä¾‹ï¼Œå†…éƒ¨å®ç°çº¿ç¨‹å®‰å…¨çš„è¿æ¥è·å–ä¸é‡Šæ”¾ã€‚

### 3. **Multi-Reactor æ¨¡å‹**
- **Master Loop**: è´Ÿè´£ `Acceptor` æ¥å—æ–°è¿æ¥ã€‚
- **Slave Loops**: è´Ÿè´£ `TcpConnection` çš„ IO è¯»å†™ã€‚
- **Task Queue**: ä¸šåŠ¡é€»è¾‘åœ¨ EventLoop çº¿ç¨‹ä¸­å®‰å…¨æ‰§è¡Œã€‚

## ğŸ“‹ CMakeç»“æ„

### é¡¶å±‚ CMakeLists.txt
```cmake
# ç®¡ç†å…¨å±€é…ç½®å’Œç¬¬ä¸‰æ–¹åº“
- è®¾ç½®C++20æ ‡å‡†
- ä¸‹è½½spdlogã€nlohmann/jsonã€googletest
- å¼•å…¥ base, server, client å­ç›®å½•
```

### base/CMakeLists.txt
```cmake
# åŸºç¡€åº“é…ç½®
- æŸ¥æ‰¾ SQLite3, MySQL ä¾èµ–
- ç¼–è¯‘ libchatroom_base.a
- å¯¼å‡ºå¤´æ–‡ä»¶è·¯å¾„
```

### server/CMakeLists.txt
```cmake
# æœåŠ¡å™¨æ¨¡å—é…ç½®
- é“¾æ¥ chatroom_base
- ç¼–è¯‘ chatroom_server
```

### client/CMakeLists.txt
```cmake
# å®¢æˆ·ç«¯æ¨¡å—é…ç½®
- é“¾æ¥ chatroom_base
- ç¼–è¯‘ chatroom_client
```
